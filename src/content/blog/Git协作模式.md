---
title: Git协作模式
pubDate: 2023-10-15 21:18:00
tags:
  - Git
  - 团队协作
description: Git有哪些多人协作模式？本篇展现常见的三种，后续将加入图示和练习。下一篇计划是“Git场景实战锦集”，专讲实战常见问题。
image: https://images.weserv.nl/?url=s2.loli.net/2023/10/18/KnsRmxWCT64YXce.webp
---

# Git协作模式

## 省流版 - TL;DR

1. 不同仓库：fork，更改后提PR，合并到原仓库（开源项目 | 非团队 | PR | Code Review ）
2. 同一仓库：开设不同分支，提PR合并到主分支（产品迭代/开源项目 | 团队 | PR | Code Review）
3. 同一仓库同一分支：在同一条分支上开发（产品迭代 | 团队 | 无PR | 无Code Review）

## 开篇 - Intro

承接上篇一些零散的问题，本篇主讲笔者在实际观察、合作与工作中总结得到的三种基于Git的写作模式。阅读了上篇的读者也可发现，上篇所遇问题虽然有使用到Git，但基本只是单人开发，主要用于版本控制，让代码在不同主机保持一致。

### 基础 - Pre-requisite

- 对Git有初步了解
- 使用过Git的基本指令
- 在任意一个支持Git的仓库托管平台注册了帐号（Github、GitLab、Gitee等）
- 能够克服国内防火墙带来的不稳定
- 想要了解项目团队协作的运作原理

## 入门 - Getting started

开始之前，这里有一些常见的名词与缩写，此处提及，下文不再赘述。

### 名词解释

- fork：分叉，“复制”当前仓库到自己帐号下，随后开发者在“复制”的这份代码进行 开发 或 修改。修改fork的仓库不会对原仓库造成影响。
- PR：Pull Request（拉取请求），有的叫Merge Request（合并请求），即请求合并自己的代码。PR可以被拒绝、被关闭，也可以重新打开，未合并的PR自动跟随到fork仓库对应分支的最新版。
- merge：合并，指合并分支或合并代码。在代码没有冲突的情况下，merge将代码加和到一起
- 代码冲突：拉取新代码与本地更新有冲突。具体过程来说，本地commit了一个更改后，想要push，但远程分支有更新，git将提示你先pull下来。如果pull下来更改过的文件，刚好也被你改了，这时候就会出现冲突。
- issue：提问/建议，一般在此提供bug反馈、新功能新需求和建议，这里也是不少PR的“发源地”、“故事开始的地方”。
- Code Review：代码检查，人工审核，也有些项目在人工审核之前使用机器人审核一遍基本要求
- PMS：项目管理系统，一般是内部网站，全称应该是Project Manager System，也有的叫PM，开发团队使用的项目管理工具。需求拆分后，需要有人将需求登记到该系统，以便溯源、整理需求。有的公司PMS还涉及绩效考核。、
- 主分支：抽象概念，指“想要合入的分支”，主分支可能是master，也可能是当前版本开发分支。

### 我的Git Guideline

个人在实际工作中总结下来的Git Guideline。

- 打开仓库先git pull，再做其他操作
- 如果遇到棘手的情况，善用git stash再操作，防止代码丢失
- Git commit使用`npx cz`或者[这一篇文章](https://open.leancloud.cn/git-commit-message/)提到的Git风格
- 想提PR的话不要有太多次git commit（3次以内），否则主分支一更新，你的代码冲突量将翻倍——你的PR会被认真考虑然后反复修改，而主分支的更新是不可避免的
- 遇到冲突不要慌，在编辑器内解决
- PR遵循仓库Guideline，没有则与其他人保持一致（如PR标题是否英文、内容格式）

## 正文

### 基于fork的协作模式

#### 介绍

- 开源
- 你不是开发团队的一员
- 需要提PR
- 支持邮件通知

这种模式常见于开源项目。对于一个公开的（或者有权限的）仓库，用户可将其fork到自己帐号下。

（在每个代码托管平台都有类似fork的功能，可能也叫“分支”，但这与branch混淆，故我这里直接叫fork或者“分叉”）

相比branch建立新分支，fork形式更像是复制了一份整个仓库。与复制不同的是，fork的仓库保留原仓库的引用、证书，并且会对比原仓库的相同分支，比如“落后了3个更新”显示“3 commits behind”，领先了一个更新显示“1 commit ahead”；同时，fork之后，可见其fork数变化（类似star）。fork后的仓库还提供与原仓库同步的功能。

> 那么问：直接在原仓库修改不好么？

首先是权限，原仓库不可能对每个人开放commit权限。何况许多人只是想稍微修改一下，加装自己的需求，不一定是想对原仓库做出贡献。如果手动下载代码，再上传，则容易丢失一些东西，如证书，原仓库地址，导致项目无从溯源，也难以集中优秀的更改。

其次是开源项目参与人数众多。如果所有人都要对原仓库的代码进行修改，commit冲突的概率极大，覆盖别人的代码简直不要太容易。

那么退而求其次，分支呢？每个人都要开一个分支，我们仍然要授予这些人修改原仓库的权利，既不安全也不高效——人一多，分支数不过来，然后滚轮找半天。

#### 应用场合

好了，简单理解就是有一个开源项目，我不是其开发团队成员，但是：

- 我写了一个很好的更新，开发组也许会需要它
- 我提了issue而开发组接纳了该意见，但开发组表示：你可以尝试做一个然后提个PR
- 我确定有个bug修得比开发组快，恰巧开发组还没做
- 我发现文档有小虫子，我知道规范并且知道如何改会更好

那么此时，我可以fork一下，写代码，然后提交自己的更改，提一个PR回到原仓库的开发分支（没有的话可能直接在master分支），看看开发组有没有更多建议。

假如开发组认为这很好，会选择merge你的PR。

当然，事实往往比较残酷，国内外稍有规模的开源项目首先过一轮机器人检测，对语法、PR格式做检查。然后是开发团队的审查，开发者会认真地考虑你所提PR的必要性，并假设：

- 没有你的PR，项目是否活不下去
- 接受了你的PR，项目是否活得下去

因为每一个陌生的更改都可能导致潜藏的问题。开发者的严格一般体现在对你的语法、注释、最佳实践、算法效率、系统效率、可替代性等等方面提出问题，检验你是否认真地作为该项目开发者考虑过项目的生命、未来以及用户的感受。

所谓严师出高徒，这种情况下能得到Merge的PR往往有着极高的含金量。

当然，开源项目并非全是这样。不少小型开源项目也仅仅是作者一个人在开发。

在作者缺乏时间和创意的时刻，如果你为他项目里肉眼可见的大小功能提了一个PR，清晰描述你所做的改变，并且注意了编程规范，作者也很乐意接受你的PR，并且你会得到一句：

> wow, seems good to me.

#### 操作 | 经验记录

fork并提交更改到远程后，打开你的fork仓库，一般会提示“创建Pull Request”（Github是横幅提示 + 一个绿色的“Pull Request”按钮，有些要进入Commit列表才能看到Merge Request按钮），按照原仓库给的Guideline，填写PR内容，指定参与者（可选）。

在去年我参加青训营第四届时，我们采用的是这种模式。那会没有协作经验，对Git认识仅限于commit push pull，一位大佬首先提了PR，然后咱按图索骥、照猫画虎，大概知道了如何操作，便用了起来。

好处是PR会可以附带足够信息，支持邮件通知，有些组织内部还会有PR Bot，提醒仓库的变化、有谁在PR，不会在无提醒的情况下更新，然后git pull导致简简单单代码冲突。

总结下来：

- 开源项目贡献常用
- 适用于不是开发团队的个人
- 会有Code Review，即代码检查
- fork后能够提PR回去的人凤毛麟角

### 基于不同分支的协作模式

#### 介绍

- 需要提PR
- 支持邮件通知

同一个仓库下如果有不同分支，也可以向另一个分支提交PR，形同fork。一般是由“开发分支”提交PR到“主分支”，当然如果项目有发版周期，往往先合并到当前版本的开发分支，确定要发版了，合到主分支，随后构建、部署上线。说多了要涉及开发与生产环境的，这些之后有机会再聊。

#### 应用场合

至少有有两种应用场合之一，两者之间不冲突：

- 你是开发团队的一员
- 每个人负责不同模块，建立不同分支

#### 操作 | 经验记录

在重构荟聚通和参与N次方开发时，团队使用的是这种写作形式：每个人独自开一个分支，负责自己的内容，好了之后提PR到主分支。

期间，不可避免地会遇到PR先后开启的情况。

内部协商方案是同一时间只有一个开启的PR，其余暂时先关闭，由Code Review负责人决定先合并哪个PR。每合并一个，下一个需要被合并的PR发起者先将主分支的内容更新到自己的分支上（git rebase master dev_xxx），然后重新开启PR，Code Review，合并。如此循环直到全部PR合并完成。

这样做好处类似“短作业优先”，负责人一般选择问题不大、实现较好、可维护性高的PR优先合并（即后发问题、需要重新PR的可能性较小），其余关闭的PR先作修改再打开，不至于一直排队。坏处是后合并的PR代码冲突的可能性越大，加上“需要修改”本身说明提交者在某些方面遇到困难，忙到后期可能手忙脚乱。此时团队成员需要积极给予帮助。

### 基于同一分支的协作模式

#### 介绍

- 不需要提PR
- 容易冲突，开始写代码前一定要git pull

#### 应用场合

至少有有三种应用场合之一，三者之间不冲突：

- 你是开发团队的一员参与本次该仓库开发的人不超过2个
- 每次新版本，团队使用PMS创建（或者手动创建）一个分支（一般带版本号）
- 所有负责该仓库的开发人员，都在这一个分支进行开发

#### 操作 | 经验记录

我在实习这段时间，团队（我所在的组）内使用的是这样的协作方式。组内有1-3个前端人员，使用了PMS系统创建和保护该开发分支，且只能创建一个（因为有两个分支，负责人需要解决合并冲突，这不现实）。

因为直接push到分支，所以没有Code Review（如果不算Eslint、Commitlint的话）

这种在版本迭代比较快、对代码质量有信心的团队内使用。

> 开始写代码前一定要git pull

## 总结

文章初步总结了笔者以前端视角遇到的协作方式，后续将会配上图片、实践练习以加深读者的对文章的理解。

